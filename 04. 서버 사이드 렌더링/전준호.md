## ✨ 4.1 서버사이드 렌더링이란?

### 과거의 웹 어플리케이션

- PHP 와 JSP를 기반으로 서버에서 렌더링 작업을 하고 HTML 파일을 제공했다 이러한 방법은 페이지 전환이 발생할 때 새로운 HTML을 서버로부터 받아오게되고 화면의 처음부터 그리는 과정을 거치기 때문에 빈 화면을 보게 되는 경험을 하게 된다.
- 자바스크립트의 역할과 규모가 커지면서 SPA가 유행하기 시작했다. 기존의  페이지 전환시 새로운 HTML을 제공하는 방식의 사용자 경험을 개선하고, 개발자들은 내부의 자바스크립트를 작성하는 것에만 집중하여 간편한 개발 경험을 제공했다.
- 스크립트 리소스가 커지게 되면서, 자바스크립트 파싱을 위한 시간과, 상호작용까지 걸리는시간, 모든 콘텐츠가 로딩 되는 시간이 커지게 되었다. 기술의 발달로 이러한 문제들이 해결될것이라고 기대했지만, 과거나 지금이나 크게 변한게 없다.

### 서버사이드 렌더링

  최초의 페이지를 서버에서 렌더링해서 빠르게 사용자에게 화면을 제공할 수 있도록 한다.

**장점**

- 최초 페이지 진입이 비교적 빠르다
  사용자가 페이지에 진입했을 때 유의미한 정보가 그려지는 시간 (First Contentful Paint) 이 짧다.
SPA를 생각했을 때 많은 정보들이 외부 API 호출을 통해 이루어진다면 자바스크립트를 파싱하고, 모든 작업들이 실행된 이후에 유의미한 정보들이 보여지기 시작한다. 서버에서 이러한 작업들을 미리 처리하고 보내준다면 일반적으로 더 빠르게 화면에 보여줄 수 있다.
- 검색엔진 최적화
  검색 엔진 로봇이 페이지에 진입했을 때, HTML을 받지만 자바스크립트는 실행하지않는다. 그 결과 추가적인 조치를 하지 않는다면 검색엔진에서 불이익을 받을 수 있다.
- 누적 레이아웃 이동이 적다
  페이지를 보여준 후에 추가적으로 HTML에 작업이 일어나면 부정적인 경험을 줄 수 있다.
- 보안에 안전할 수 있다

**단점**

- 코드를 작성할 때 서버에대한 고려가 필요하다
- 서버를 구축해야한다.
- 서비스 지연시 빈 화면을 보게되는 시간이 더 길어질 수 있다.

### 현대의 방식 ?

최초의 진입시에는 SSR을 활용하고 이 후 페이지 내부의 이동은 SPA 처럼 동작한다.

## ✨ 4.2 서버사이드 렌더링을 위한 리액트 API

- renderToNodeStream 을 이용해서 한번에 모든 HTML을 보내는것이 아닌, 작은 단위로 분할해서 사용자에게 제공해 줄 수 있다. 대부분 이 방식을 채택한다.

### Hydrate

  서버에서 제공한 HTML에 자바스크립트를 이용해서 상호작용한 페이지를 만드는 과정

  이미 만들어진 HTML과 Hydrate의 결과물을 비교하고 작업이 일어나게 된다. 서버에서 제공한 HTML과 Hydrate가 수행한 렌더링 정보가 일치하지 않게되면  Hydrate를 기준으로 다시한번 페이지가 리렌더링이 일어난다. 결과적으로 브라우저에서 페이지를 위해 2번의 렌더링 작업이 일어나게 된다. 이런 상황을 피하기 위해서 반드시 서버에서의 결과물과 클라이언트에서의 결과물이 같아야한다. (render 작업이 pure 해야하는 이유 ?)                          

## ✨ 4.3 Next.js 와 SSR

- Next는 처음의 초기 진입에만 SSR을 이용하고 그 후 내부의 페이지 이동시에는 router를 사용해서 SPA 처럼 행동한다.
- 페이지의 특성에 따라서 빌드시점에 페이지를 정적으로 만들지, 동적으로 제공할지 결정한다.

- getServerSideProps : 서버에서 페칭을 진행하고 해당 정보를 가져와 컴포넌트에 제공한다
- getStaticProps : 서버에서 페칭을 진행하고 해당 정보를 가져와 컴포넌트에 제공한다, 정적 페이지를 만든다.
- getInitialProps : 위 2개가 나오기 이전에 사용했던 Props 전달 방식, 서버와 클라이언트 모두에서 실행될 수 있다.

## ✨ 4.3 CSS 적용하기

- 전역
    
    어플리케이션 전체에 적용하고 싶은 CSS 스타일, _app.tsx에 적용한다.
    
- 컴포넌트 레벨
컴포넌트 단위로 CSS를 적용할 수 있다

### CSS-IN-JS

서버에서 스타일을 모아서 서버사이드 렌더링시 일괄적으로 적용하는 과정

CSS없이 HTML이 노출되고 이후에 CSS가 입혀지는 현상을 방지할 수 있다.
