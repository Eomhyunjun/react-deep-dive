# 7.1 크롬 개발자 도구란?

- 제대로 디버깅하고 싶다면 시크릿 모드 또는 프라이빗 모드에서 개발자 도구를 여는 것을 권장한다.
- 각종 확장 프로그램은 실행을 위해 전역 변수나, HTML 요소에 다른 정보를 추가하기도 한다. 이런 점이 디버깅에 방해가 될 수 있기 때문이다.

# 7.2 요소 탭

- 현재 웹 페이지를 구성하고 있는 HTML, CSS 정보를 확인할 수 있다.
- 직접 HTML을 수정할 수 있다. 리액트 코드를 직접 수정하지 않더라도 미리 확인할 수 있어 빠른 작업이 가능하다.
- 요소를 특정하여 중단 위치(하위트리 수정, 속성 수정, 노드 삭제)를 설정하면 해당 작업이 발생하면 렌더링을 중단한다.

- 스타일 탭: class, id 등으로 매핑된 스타일을 확인 및 수정하여 바로 확인할 수 있다.(자주 사용)
- 계산됨 탭: padding, border, margin 등이 적용된 결과를 확인할 수 있다.
- 레이아웃 탭: grid, layout 관련된 정보를 확인할 수 있다.
- 이벤트 리스너 탭: 요소에 부착된 이벤트 리스너를 확인할 수 있다. 이벤트 버블링으로 이벤트를 발생시키는 경우에는 확인할 수 없다.
- DOM 중단점 탭: 설정한 중단점을 확인할 수 있다.
- 속성 탭: 요소가 가지고 있는 모든 속성을 보여준다.
- 접근성 탭: 스크린리더기 등이 활용하는 값을 포함하고 있다.

# 7.3 소스 탭

- 웹 페이지를 불러오기 위해 실행되거나 참조된 모든 파일을 확인할 수 있다.
- Javascript, CSS, HTML, 폰트까지 다양한 파일 정보를 확인할 수 있다.
- 소스 중단점을 생성해 실행을 중단하고 디버깅을 수행할 수도 있다.
  - 변수 값, 코드 동작 순서, 실행 구조를 확인하는데 유용하다.
- 소스 코드에 debugger를 선언하는 것과 동일한 역할을 하지만, 소스 코드를 오염시키지 않으므로 더 유용하다.

- 감시: 감시하고 싶은 변수를 선언하고, 해당 변수의 정보를 확인할 수 있다. 디버깅 시점에서 특정 변수의 값을 알고 싶다면 추가할 수 있다.
- 중단점
- 범위: 현재 중단점에서의 스코프를 의미한다.
- 호출 스택
- 전역 리스너: 전역 스코프에 추가된 리스너 목록을 볼 수 있다.
- XHR/fetch Breakpoints: 소스 중단점 이외에 다양한 중단점을 확인할 수 있다.

# 7.4 네트워크 탭

- 해당 웹 페이지를 접속하는 순간부터 발생하는 모든 네트워크 관련 작동이 기록된다.
  - HTTP 요청, 웹 소켓
- 어떤 외부 주소로부터 어떤 종류의 리소스를 가져오는지 시간 순서대로 확인할 수 있다.
- Screenshots 옵션을 통해 시간에 따라 배경이 완성되는 것을 볼 수 있다.

- 다음과 같은 점을 확인해보자.
  1.  불필요한 요청 또는 중복되는 요청이 있는지
  2.  웹 페이지 구성에 필요한 리소스 크기가 너무 크지 않은지
  3.  리소스를 불러오는 속도는 적절한지, 너무 오래 걸리지 않는지
  4.  리소스가 올바른 우선순위로 다운로드되어 페이지를 자연스럽게 만들어가는지

# 7.5 메모리 탭

- 현재 웹 페이지가 차지하고 있는 메모리 정보를 확인할 수 있다.
- 메모리 누수, 속도 저하, 웹 페이지 프리징 현상을 확인할 수 있다.

## 자바스크립트 인스턴스 VM 선택

- 해당 페이지가 자바스크립트 힙을 얼마나 점유하고 있는지 나타낸다.

## 힙 스냅샷

- 현재 페이지의 메모리 상태를 확인해 볼 수 있다.
- **스냅샷을 하는 시점을 기준으로 메모리 현황을 보여준다.**
- 메모리 누수가 발생할 것으로 예상되는 스크립트 전후로 내용을 촬영해 비교하는 것이 좋다.

## 타임라인 할당 계측

- 앞의 기법이 특정 시점의 내용을 기록하는 것이라면, 타임라인 할당 계측은 시간의 흐름에 따라 메모리 변화를 확인할 수 있다.
- 비교적 부담이 크다.
- 기간을 좁혀서 확인해볼 수 있다는 장점이 있다.

## 할당 샘플링

- 시간의 흐름에 따라 발생하는 메모리 점유를 확인할 수 있다는 점에서 타임라인 할당 계측과 비슷하다.
- 하지만 실행 스택별로 분석할 수 있고, 이 분석을 함수 단위로 한다는 차이점이 있다.
- 타임라인 할당 예측과 유사하지만 프로파일링할 때 브라우저에 주는 부담을 최소화할 수 있어 장시간에 걸쳐 디버깅을 수행해야 할 때 유리하다.

# 7.6 Next.js 환경 디버깅하기

- 이전까지는 클라이언트 환경에서 메모리 누수가 발생한 상황을 가정하였는데, 서버 사이드 렌더링을 수행하는 자바스크립트 환경에서 메모리 누수가 발생한다면 어떻게 될까?
- 서버 자체에 부담이 생길 것이고, 모든 사용자에 영향을 미치는 중요한 문제이다.
- 놀랍게도 서버 환경도 도일하게 크롬 개발자 도구로 디버깅이 가능하다.

## Next.js 프로젝트를 디버그 모드로 실행하기

1. Next.js 서버 실행

```shell
NODE_OPTIONS='--inspect' next dev
```

2. Chrome browser에서 입력

```shell
chrome://inspect
```

3. Open dedicated DevTools for Node 클릭

4. 트래픽 유입

```shell
ab -k -c 50 -n 10000 "http://127.0.0.1:3000/"
```

- 주소로 한 번에 50개의 요청을 총 10,000회 시도한다.

5. 브라우저에서 스냅샷을 통해 확인

## 정리

- 메모리 누수 원인이 불명확한 경우가 많기 떄문에, 의심되는 지점을 찾고 코드를 수정하고 프로파일링하는 과정을 반복해야 한다.
- 또한 원인이 자신의 코드 또는 라이브러리일수도 있기 때문에 주의가 필요하다.
