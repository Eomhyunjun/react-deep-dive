# 08장: 좋은 리액트 코드 작성을 위한 환경 구축하기

- 중요: 좋은 코드를 작성할 수 있는 환경을 구축하는 것
- 사전작업 ESLint와 리액트를 테스트할 수 있는 테스트 라이브러리에 대해 살펴보고자 함.

⇒ ESLint를 활용한 정적분석(소스 코드의 실행 없이 정적으로 프로그램의 문제를 찾는 과정)과

리액트 테스트 라이브러리를 충분히 활용한다면, 여러가지 문제를 사전에 점검하고 확인할 수 있다.

## 8.1 ESLint를 활용한 정적 코드 분석

**정적분석**: 코드 실행과는 별개로 코드 그 자체만으로 코드 스멜(잠재적으로 버그를 야기할 수 있느 코드)을 찾아내어 문제의 소지가 있는 코드를 사전에 수정하는 것

### 8.1.1 ESLint 살펴보기

리액트는 어떤 방식으로 코드를 정적 분석할 수 있을까?

**ESLint는 어떻게 코드를 분석할까?**

간단하게 요약하면 다음과 같다.

1. 코드를 문자열로 읽는다.
2. 파서로 코드를 구조화한다.
3. 구조화한 트리를 AST(Abstact Syntax Tree)라 하며, 이 트리를 기준으로 각종 규칙과 대조한다.
4. 규칙과 대조했을 때 이를 위반한 코드를 알리거나 수정한다.

ESLint는 기본적으로 espree를 사용하여 파일을 구조화한다.

### 8.1.2 eslint-plugin과 eslint-config

**eslint-plugin:** 규칙을 모아놓은 패키지

**eslint-config**: plugin을 모아놓은 패키지

- eslint-plugin, eslint-config과 관련된 네이밍 규칙
  - eslint-plugin, eslint-config 접두사 붙여야 함.
  - 뒤에 한 단어만 가능, 특정 스코프 붙는 것 가능
  - 예를들어 `@titicaca/eslint-config-triple` 가능

**eslint-config-airbnb**: 압도적 다운로드 수!

**@titicaca/triple-config-kit:** → 근데 얘는 왜 네이밍 규칙 안따르나요?

- 스타트업 개발사 트리플이 개발 중
- 자체적 정의한 규칙 기반
- 외부로 제공하는 규칙에 대한 테스트 코드 규칙 제공
- Prettier와 Stylelint를 각각 별도의룰로 모노레포 만들어 관리함.
- 한국 커뮤니티에서 유지보수되는 config를 사용하고 싶거나 자체적인 구축에 관심이 있다면 도움 될 것

**eslint-config-next:** Next.js용

### 8.1.3 나만의 ESLint 규칙 만들기

**이미 존재하는 규칙을 커스터마이징해서 적용하기: import React를 제거하기 위한 ESLint 규칙 만들기**

- import React 안써도 되는데 import하면 용량 낭비
- 파일 크기도 차이가 좀 남

  - 사실은 트리쉐이킹해서 파일 크기 차이는 안남
  - 대신 빌드 시간 줄일 수 있음

- 기존의 no-restricted-imports 커스터마이징해서 규칙 만들 것이미

### 8.1.4 주의할 점

**Prettier와의 충돌**

- Prettier는 코드 포멧팅을 도와주는 도구다.

1. Prettier에서 제공하는 규칙을 ESLint에서는 끄는 방법
2. 자바스크립트나 타입스크립트는 ESLint에, 그 외의 파일은 Prettier에 맡기는 방법
   1. 대신 자바스크립트에 추가적으로 필요한 Prettier 관련 규칙은 eslint-plugin-prettier를 사용

**규칙에 대한 예외 처리, 그리고 react-hooks/no-exhaustive-deps**

일부 코드에서 특정 규칙을 임시로 제외시키고 싶다면 → eslint-disable- 주석 사용

- 특정 줄, 파일 전체, 특정 범위로 설정 가능

**ESLint 버전 충돌**

## 8.2 리액트 팀이 권장하는 리액트 테스트 라이브러리

- 프론트엔드, 백엔드 모두 테스팅 중요하지만 테스팅 방법과 방법론 다름.

- 백엔드

  - 데이터 올바르게 가져올 수 있는 지.
  - 데이터 수정 간 교착 상태, 경쟁 상태가 발생하지 않는 지.
  - 데이터 손실은 없는 지
  - 특정 상황에서 장애가 발생하지 않는 지

  ***

  - 화이트박스 테스트 → 작성한 코드가 의도대로 동작하는 지 확인
  - GUI가 아닌 AUI(Application User Interface)에서 주로 수행되기 때문에, 백엔드에 이해가 있는 사람만 가능

- 프론트엔드
  - 일반적인 사용자와 동일하거나 유사한 환경에서 수행
  - 비지니스 로직이나 모든 경의 수를 고려해야 함
  - 사용자가 굳이 프론트엔드 코드를 알 필요는 없음
  ***
  - 블랙박스 테스트 → 의도한대로 동작하는 지를 확인하는데에 좀 더 초점
  - 최대한 예측해서 확인해야 함. 사용자가 개발자의 의도대로만 사용하지 않기 때문.

### 8.2.1 React Testing Library란?

- DOM Testing Library를 기반으로 만들어진 라이브러리
  - DOM Testing Library ⇒ jsdom을 기반으로 함.
  - Node.js같은 환경에서도 HTML을 사용할 수 있도록 해줌
- 리액트를 기반으로 한 테스트를 수행하기 위해 만들어졌다.

### 8.2.2 자바스크립트 테스트의 기초

**테스트의 동작**

- 작성한 코드가 예상대로 작동하면 성공했다는 메세지가 출력되고
- 실패하면 에러를 던진다

⇒ Node.js → assert라는 모듈을 제공.

```jsx
const assert = require("assert");

function sum(a, b) {
  return a + b;
}

assert.equal(sum(1, 2), 3);
assert.equal(sum(2, 2), 4);
assert.equal(sum(1, 2), 4); // AssertionError
```

- 이처럼 테스트 결과를 확인할 수 있도록 도와주는 라이브러리를 어설션(assertion) 라이브러리라고 함

  - Node.js가 제공하는 assert외에도 should.js, expect.js, chai 등 다양함
  - equal 외에도, deepEuql, notEqual, throws 등 다양한 메서드 제공

- 테스트 코드 → 어떤 테스트가 무엇을 통과했는 지 보여주는 것도 중요
- 이런 기승전결을 보여주는 것이 테스팅 프레임워크

- 테스팅 프레임워크 ⇒ 어설션 기반 테스트 수행 + 테스트 코드 작성자에게 도움이 될 만한 정보를 알려주는 역할
- 유명한 프레임워크 Jest, Mocha, Karma, Jasmine 등

- 리액트에서는 메타에서 만든 Jest가 널리 쓰임. 자체 제작한 expect 패키지를 사용하여 어설션 수행
- 책을 쓴 시점에는 어떤 직원도 유지보수하고 있지 않았던 것으로 보임.
  ⇒ 관리 주체가 오픈소스 재단으로 바뀌어 활발하게 유지보수 될 것으로 기대 (⇒ 지금은 되는 듯?)

### 8.2.3 리액트 컴포넌트 테스트 코드 작성하기

리액트 컴포넌트를 테스트하는 법

1. 컴포넌트 렌더링
2. 컴포넌트에서 필요한 액션 수행
3. 결과 비교

### 8.2.4 사용자 정의 훅 테스트하기

**`react-hooks-testing-library`**를 활용

### 8.2.5 테스트를 작성하기에 앞서 고려해야 할 점

테스트 코드를 작성하기 전 생각해봐야할 최우선 과제 = **“애플리케이션에서 가장 취약하거나 중요한 부분 파악”**

### 8.2.6 그 밖에 해볼 만한 여러 가지 테스트

- 유닛 테스트: 각가의 코드나 컴포넌트가 독립적으로 분리된 환경에서 의도된 대로 정확히 작동하는지 검증하는 테스트
- 통합 테스트: 유닛 테스트를 통과한 여러 컴포넌트가 묶여서 하나의 기능으로 정상적으로 작동하는지 확인하느 테스트
- 엔드 투 엔드: 흔히 E2E 테스트라 하며, 실제 사용자 처럼 작동하는 로봇을 활용해 애플리케이션의 전체적인 기능을 확인하는 테스트
