813 - 874

# 13. 웹페이지의 성능을 측정하는 다양한 방법

## 13.1 애플리케이션에서 확인하기

### 13.1.1 create-react-app

- reportWebVitals -> 웹에서 성능을 측정하기 위한 함수

  - 누적 레이아웃 이동 (CLS), 최초 입력 지연 (FID), 최초 콘텐츠풀 페인트 (FCP), 최대 콘텐츠 페인팅 (LCP), 첫 바이트까지의 시간 (TTFB) 측정에 이용
  - web-vitals 라이브러리를 이용하여 측정하며, 이러한 라이브러리는 PerformanceObserver라는 API를 사용한다.
  - ReportHandler는 성능 객체인 Metric을 인수로 받아서 원하는대로 다룰 수 있다.

- 어딘가에 기록하고 싶다면 sendBeacon API나 fetch 등을 이용하면 된다.

### 13.1.2 create-next-app

- Next.js 는 성능 측정을 할 수 있는 메서드인 NextWebvitalsMetric을 제공한다.
- 핵심 웹 지표 이외에도 SSR에서 하이드레이션하는데 걸리는 시간, 페이지가 경로 변경 후 렌더링을 시작하는데 걸리는 시간, 경로 변경이 완료된 후 렌더링하는데 걸린 시간 등을 측정할 수 있다.
- Next.js는 최초에 SSR을 하기 때문에 하이드레이션 지표는 최초에만 측정된다.

## 13.2 구글 라이트하우스

- 라이트하우스를 이용하면 별도의 애플리케이션 코드 수정이나 배포, 수집 없이도 지표를 수집할 수 있다.

### 13.2.1 구글 라이트하우스 - 탐색 모드

- 핵심 지표 외의 3가지 추가 지표

  - Time to Interactive: 페이지에서 사용자가 완전히 상호작용(인터랙션) 할 수 있을 때까지 걸리는 시간.
  - Speed Index: 페이지가 로드되는 동안 콘텐츠가 얼마나 빨리 시각적으로 표시되는지를 계산.
  - Total Blocking Time: 메인 스레드에서 특정 시간 이상 실행되는 작업, 즉 긴 작업이 수행될 때마다 메인 스레드가 차단된 것으로 간주한다. 50ms가 초과 되는 작업에서 초과된 시간들만 따로 합산한다.

- 위의 지표들을 기반으로 개선할 부분을 알려준다.
  - 접근성 -> 웹 접근성은 신체적으로 불편한 사람들(장애인, 고령자 등)이 웹페이지를 이용할 수 있도록 보장하는 것이다.
  - 권장사항 -> 보안, 표준 모드, 최신 라이브러리, 소스 맵 등 웹 사이트 개발할 때 고려해야 할 요소들을 얼마나 지키고 있는지 확인한다.
  - SEO

### 13.2.2 구글 라이트하우스 - 기간 모드

- 시작과 끝을 지정해서 기간 모드 동안 일어난 작업들의 성능을 확인할 수 있다.

- 기본적으로 탐색 모드와 같은 기능에 추가적으로 흔적과 트리맵 기능이 있다.
  - 흔적 -> view trace, 웹 성능을 추적한 기간을 성능 탭에서 보여주는 기능. 구글의 제안을 넘어서, 시간에 흐름에 따라 어떻게 웹페이지가 로딩됐는지를 보여준다.
  - 트리맵 -> 페이지를 불러올 때 함께 로딩한 모든 리소스를 함꼐 모아서 볼 수 있는 곳이다. 로딩한 리소스에서 불러왔지만 사용하지 않은 바이트의 크기를 확인할 수 있다.

### 13.2.3 구글 라이트하우스 - 스냅샷

- 현재 페이지 상태를 기준으로 분석한다. 특정 페이지 특정 상태를 기준으로 분석하고 싶다면 이 모드를 이용하면 된다. 탐색 모드와 유사하다.

## 13.3 WebPage Test

- 웹 성능 분석 도구로 가장 잘 알려짐
- 분석 도구 분류
  - Site Performance -> 웹사이트 성능 분석
  - Core Web Vitals -> 웹사이트 핵심 웹 지표 확인
  - Lighthouse -> 라이트하우스
  - Visual Comparison -> 2개 이상의 사이트를 동시에 실행해 시간의 흐름에 따른 로딩 과정을 비교
  - Traceroute -> 네트워크 경로를 확인하는 도구

### 13.3.1 Performance Summary

- WebPageTest는 성능 테스트 총 3번 수행하기 때문에 3개의 결과 받을 수 있다.

- Opporluniies & Experiments
  - Is it Quick -> 웹 사이트가 빠른지 평가. TTFB가 짧은지, 콘텐츠 렌더링이 즉각적으로 일어나는지, LCP 시간이 합리적인지 확인한다.
  - Is it Usable -> 웹 사이트의 사용성, 시각적 요소 확인. CLS 최소화, 상호작용을 빠르게 할 수 있는지, 접근성 이슈, 클라이언트 사이드에서의 과도한 HTML 렌더링 등을 확인한다.
  - Is it Resilient -> 보안 취약성 점검. 렌더링을 블로킹하는 제 3자 라이브러리의 존재하는지, 보안 위험 요소가 있는지 확인한다.
- Observed Metric
  - 최초 바이트까지의 시간. 렌더링 시작에 소요되는 시간, 최초 콘텐츠풀 페인트 등을 측정. 시간의 흐름에 따라 웹페이지의 렌더링을 확인할 수 도 있음.
- Individual Runs
  - 3번으로 이루러진 테스트 진행 후 평균값 출력.

### 13.3.2 Opportunities & Experiments

- TTFB
- 렌더링을 블로킹하는 JS, CSS가 있는 확인
- 최초 콘텐츠풀 페인트가 2.5초 이내인지 확인
- 주요 영역 내에 lazy loading 이미지가 있는지 확인. 주요 영역은 빠르게 로딩 되는게 좋다.
- 주요 영역 외부에 lazy loading 이미지 확인. 뷰포트 이외에는 lazy loading을 적용해서 천천히 로딩 되는게 좋다.
- 문자의 노출을 지연시키는 커스텀 폰트가 있는지 확인
- 제 3자 호스트에서 폰트를 불러오는지 확인한다. 폰트는 캐싱되지 않아서 이점이 없음
- 실제로 사용하지 않는 리소스를 rel=preLoad로 불러오지 않는지 확인
- HTTP 리다이렉트되는 리소스가 없어야함
- 최초로 다운로드받은 HTML 과 최종 결과물 HTML 사이에 크기 차이가 적어야함
- Is it Usable
  - 이미지 크기를 지정하여 레이아웃 이동 제거
  - 메인 스레드 블로킹 시간 줄이기 (JS 크기 줄이기)
  - meta: viewport 삽입
  - 접근성 이슈
- Is it Resilient
  - 렌더링 막는 제 3자 라이브러리 요청이 없어야함.
  - Snyk 에서 검출된 보안 위협이 없어야 함
  - 모든 요청은 HTTP가 아닌 HTTPS를 거쳐야 함

### 13.3.3 Filmstrip

- 시간의 흐름에 따라 어떻게 웹사이트가 그려졌는지, 어떤 리소스가 불러와졌는지 볼 수 있는 메뉴.

### 13.3.4 Details

- Filmstrip에서 보여준 내용을 자세하게 보여주는 영역. 요청에 대한 상세한 설명을 볼 수 있다.

### 13.3.5 Web Vitals

- LCP, CLS, TBT에 대한 제사한 내용을 확인할 수 있다.
- 시간의 흐름에 따라 LCP가 어떻게 변화했는지 확인할 수 있다.
- CLS는 어떤 요소가 레이아웃 이동에 영향을 미쳤는지 알 수 있다.

### 13.3.6 Optimizations

- 리소스들이 얼마나 최적화돼 있는지 알 수 있다.

### 13.3.7 Content

- 웹사이트에서 제공하는 콘텐츠, 에셋을 종류별로 묶어 통계를 보여준다.
- 에셋 종류별 크기와 로딩 과정을 확인할 수 있으며, 시간의 흐름에 따라 렌더링을 거치며 어떻게 에셋을 불러오는지도 확인할 수 있다.

### 13.3.8 Domains

- Content 메뉴에서 보여준 애셋들이 어느 도메인에서 왔는지를 도메인별로 묶어서 확인할 수 있다. 그리고 해당 도메인별로 요청한 크기는 어느 정도인지도 확인할 수 있다.

### 13.3.9 Console Log

- 사용자가 웹페이지에 접속했을 때 console.log로 무엇이 기록됐는지 확인할 수 있다.

### 13.3.10 Detected Technologies

- 웹사이트를 개발하는 데 사용된 기술을 확인할 수 있는 메뉴다. 평소에 관심이 있거나 신기한 웹사이트가 있었다면 이 메뉴를 활용해 어떻게 만들었는지 짐작해 볼 수 있다.

### 13.3.11 Main-thread Processing

- Processing Breakdown -> 메인 스레드가 어떤 작업을 처리했는지 확인할 수 있다. 메인 스레드의 작업을 크게 스크립트 실행(Scripting), 레이아웃(Layout), 리소스 로딩(Loading), 페인팅(Painting), 기타의 총 다섯 가지로 분류해서 알려준다.

### 13.3.12 Lighthouse Report

- 라이트하우스 리포트를 확인할 수 있다.

### 13.3.13 기타

- 외부 제공 서비스
  - Image Analysis -> Cloudinary로 연결되며, 웹사이트의 어떤 이미지가 있는지, 최적하면 어느정도 리소스를 아낄 수 있는지 보여준다
  - Request Map -> 웹사이트에 요청이 어떻게 일어나고 있는지를 시각화 도구로 보여준다. 각 리소스 크기와 리소스 간의 연쇄 작용을 확인할 수 있다.
  - Data Cost -> 국가별로 가장 저렴한 요금제로 이 웹사이트를 로딩했을 때 실제로 얼마나 가격이 드는지 확인할 수 있다.
  - Securily Score -> Synk에서 제공하는 기능으로, 해당 사이트의 보안 취약점에 대해 알려준다.

## 13.4 크롬 개발자 도구

### 13.4.1 성능 통계

- throttling -> 고의로 네트워크와 CPU 속도를 지연시키는 기능.

- Insights

  - 성능 측정 기간동안 발생한 이벤트 중 눈여겨봐야 할 내용을 시간의 흐름에 따라 모아서 보여준다.

- 메인 메뉴
  - 메인 영역에서는 성능을 측정하는 기간 동안 무슨 일이 일어나는지 확인할 수 있는 다양한 기능을 제공한다.

### 13.4.2 성능

- 성능 통계보다 복잡하지만 더 자세히 알 수 있음.

- 메뉴
  - 기간을 정해서 성능 측정한다.
- 요약
  - 측정 기간의 CPU, 네트워크 요청, 스크린샷, 메모리 점유율 등을 알 수 있음.
  - 드래그를 통해서 시점 선택 가능.
- 네트워크
  - 성능 측정 기간 동안에 발생한 모든 네트워크 요청을 확인할 수 있다.
  - 위에 있는 요청이 우선순위가 높은 요청이다.
- Web vitals
  - 웹 지표 시점 확인.
- 소요 시간과 기본
  - 시간의 흐름에 따라 메인 스레드의 작업, JS 힙 영역의 변화를 알 수 있다.

## 13.5 정리
