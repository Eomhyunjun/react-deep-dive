# 13장: 웹페이지의 성능을 측정하는 다양한 방법13장: 웹페이지의 성능을 측정하는 다양한 방법

## 13.1 애플리케이션에서 확인하기

### 13.1.1 create-react-app

**reportWebVitals**: 웹에서 성능을 측정하기 위한 함수.

- CLS, FID, FCP, LCP, TTFB를 측정하는 용도
- PerformanceObserver API 사용
- ReportHandler: 성능 객체인 Metric을 인수로 받는 함수 타입
  - 콘솔에 출력하거나, 서버에 전송하거나 할 수 있음.

### 13.1.2 create-next-app

**NextWebVitalsMetric:** 핵심 웹 지표 외에도 Next.js에 특화된 사용자 지표 제공

- Next.js-hydration: 하이드레이션에 걸린 시간
- NExt.js-route-change-to-render: 페이지가 경로를 변경한 후 페이지 렌더링을 시작하는 데 걸리는 시간
- Next.js-render: 경로 변경이 완료된 후 페이지를 렌더링하는 데 걸린 시간

## 13.2 구글 라이트하우스

- 오픈소스 + 크롬 브라우저에서 실행 가능
- lighthouse 라이브러리 이용하면 CLI 명령어로 지표 수집도 가능

### 13.2.1 구글 라이트하우스 - 탐색 모드

- 일반적으로 페이지에 접속했을 때부터 로딩이 완료될 떄까지의 성능을 측정하는 모드
- 지표 수집이 완료되면 → 리포트 생성

**성능**

- 웹 페이지 성능과 관련된 지표
- 핵심 웹 지표 외의 3가지 추가 지표
  - Time to Interactive: 페이지에서 사용자가 완전히 상호작용할 수 있을 때까지 걸리는 시간
    - 최초 컨텐츠풀 페인트로 측정되는 페이지 내 콘텐츠가 표시되는 시점
    - 보여지는 페이지 요소의 대부분에 이벤트 핸들러가 부착되는 시점
    - 페이지가 유저의 상호작용에 50ms 내로 응답하는 시점
    - TTI 지표가 3.8이내면 좋음 / 7.3이내 보통 / 그 이상 개선 필요
  - Speed Index: 페이지가 로드되는 동안 컨텐츠가 얼마나 빨리 시각적으로 표시되는지를 계산
    - 3.4초 이내면 좋음, 5.8초 이내면 보통, 그 이후는 느림.
  - Total Blocking Time: 메인 스레드에서 특정 시간 이상 실행되는 작업, 즉 긴 작업이 수행될 때마다 메인 스레드가 차단된 것으로 간주. 그러한 작업이 50ms 이상 걸리면 긴 작업이라고 간주하고 이렇게 긴 작업을 모아서 TBT라고 함. 각각의 작업에 50ms를 빼고, 그것들을 합해서 계산.
  - 모든 긴 작업을 대상으로 하는 것이 아니고, 최초에 사용자에게 무언가 컨텐츠를 보여줬을 때(FCP)부터 상호 작용까지 걸리는 시간(TTI) 사이의 작업만 대상으로 함.

**접근성**

- 장애인, 고령자 등 신체적으로 불편한 사람들이 웹페이지를 이용할 수 있도록 보장하는 것
  - 시각적으로 보기 어려운 경우 ⇒ 스크린 리더 이용 ⇒ 웹페이지의 내용을 듣는 것이 가능
  - 그림이나 사진의 경우 ⇒ 적절한 대체 문자 필요
  - 오디오나 비디오 ⇒ 자막 필요
  - 마우스를 사용할 수 없는 경우 ⇒ 키보드로 모든 것 가능해야 함.

⇒ 이러한 적절한 대안을 삽입하는 것을 접근성이라함.

⇒ 점수를 확인할 수 있음

**권장사항**

- 웹사이트를 개발할 때 고려해야 할 요소들을 얼마나 지키고 있는 지 확인할 수 있음
- 권장사항 예시
  - 보안
  - 표준모드
  - 최신 라이브러리
    - 감지된 Javascript 라이브러리: 페이지에서 감지되는 자바스크립트 라이브러리를 의미 (JQuery, Next.js, React, Loadash, create-react-app 등) - 버전을 특정할 수 있으면 버전도 확인 가능
  - 소스 맵 등
  - 자세한 내용
    - CSP가 XSS 공격에 효과적인지 확인: CSP가 무엇인지 알기 위해서는 먼저 XSS에 대해 알아야 함.
      - XSS (Cross Site Scripting): 개발자가 아닌 제 3자가 삽입한 스크립트를 통해 공격하는 기법.1
      - CSP (Content Security Policy): 웹 사이트에서 호출할 수 있는 컨텐츠를 제한하는 정책 (이미지, 스타일, 스크립트와 같은 정적 컨텐츠, 주소, 도메인 등)
    - HTTPS 사용 여부
    - 페이지 로드 시 위치정보 권한 요청 방지: 메서드 사용 시 사용자 동의를 거치도록 함
    - 페이지 로드 시 알림 권한 요청 방지: 웹 알람 메서드 허용 여부 묻는 지 확인
    - 알려진 보안 취약점이 있는 자바스크립트 라이브러리 확인
    - 사용자 비밀번호 입력란에 붙여넣기 허용: 보안의 관점에서 붙여넣기가 가능해야 함
    - 이미지 가로세로 비율, 실제 크기와 표시 크기 확인
    - 이미지를 적절한 해상도 제공하는 지 확인
    - 페이지에 HTML Doctype 있는 지 확인 (표준)
    - 문자 집합 정의 확인: 서버가 HTML 파일을 전송할 때, 인코딩 방법을 알려주지 않으면 브라우저는 문자를 알 수 없게 됨. charset을 지정해야 함.
    - 지원 중단 API 사용 확인: 지원하지 않는 API는 보안 취약점이 될 수 있음
    - 콘솔에 로그된 브라우저 없음.
    - Chrome Devtools의 Issue 패널에 문제없음: 크롬 개발자 도구에는 문제(issue)라는 탭이 있는데, 이 탭에는 웹페이지에 대한 여러 가지 문제점을 알려줌
    - 페이지에 유효한 소스맵이 있음
    - font-display optional을 사용하는 폰트가 미리 로드됨.

**검색엔진 최적화**

- SEO가 잘 되어 있는 지 확인.

### 13.2.2 구글 라이트하우스 - 기간 모드

- 실제 웹페이지를 탐색하는 동안 지표를 측정하는 것
- 성능 측정을 원하는 작업을 수행한 다음, 기간 모드를 종료하면 확인가능

**흔적(View Trace)**

- 웹 성능을 추적한 기간을 성능 탭에서 보여줌.
- 상세하게 시간의 흐름에 따라 웹페이지가 어떻게 로딩됐는 지 보여줌.

**트리맵**

- 페이지를 불러올 때 함께 로딩한 모든 리소스를 모아볼 수 있는 곳.
- 웹페이지 전체 자바스크립트 리소스 중 어떤 파일이 데이터 로딩 중 어느정도를 차지했는 지 비율로 확인 가능.
- 불필요한 코드가 없는 지 확인하기
  - 다만 실행되지 않았다고해서 불필요한 코드는 아님
    - 특정 상황에서 쓰일 수 있기 때문

https://yozm.wishket.com/magazine/detail/2082/

### 13.2.3 구글 라이트하우스 - 스냅샷

- 현재 페이지 상태를 기준으로 분석
- 현재 상태에서 검색엔진의 최적화, 접근성, 성능 등을 분석할 수 있음

- 페이지 로딩이 아닌 특정 페이지 특정 상태를 기준으로 분석하고 싶다면 스냅샷 모드를 이용하면 됨

## 13.3 WebPageTest

- 웹 사이트 분석하는 도구로 널리 알려짐
- 심도 있는 기능은 유료로 제공하는 기능도 있음.
  - 다만 무료로 제공되는 기능만으로도 웹 사이트를 분석하는데 충분함

제공하는 분석도구

- Stie Performance: 웹 사이트 성능 분석도
- Core Web Vitals: 핵심지표 확인 (크롬과 대체 가능)
- Lighthouse: 구글 라이트 하우스
- Visual Comparison: 2개 이상의 사이트를 동시에 실행해 실행의 흐름에 따른 로딩 과정을 비교하는 도구
- Traceroute: 네트워크 경로를 확인하는 도구

- 서버가 한국에서 멀어서 지표가 구글보다 낮을 수 있음

### 13.3.1 Performance Summary

- Is it Quick - (TTFB, LCP) 확인
- Is It Usable - CLS를 최소화하고 있는 지, 상호작용을 빠르게 할 수 있는 지, 접근성 이슈 너무 많은 렌더링 등 사용성과 시각적요소 확인
- Is it Reslient: 보안 취약점 점검 + 렌더링을 블로킹하는 라이브러리 존재하는 지

### 13.3.2 Opportunities & Experiments

- Is it Quick - (TTFB, LCP) 확인
  - TTFB / 렌더링 블로킹 / 최초 컨텐츠풀 페인트 2.5 이내인지 / lazy 로딩
  - 문자 노출 지연 폰트 / 3자 호스트 폰트 (폰트 캐싱 이제 안됨, rel=preload,rel=preconnect, 동일출처에서 가져오는 것이 좋음) / 리다이렉트 리소스
  - HTML 결과물 차이

### 13.3.3 Filmstrip

필름을 보는 것처럼 시간의 흐름에 따라. 페이지 확인 가능

- CSS 스프라이트 기법으로 요청 개수를 줄이는 것 ⇒ 페이지 빠르게 로딩하는 데 도움이 됨

### 13.3.4 Details

- Filmstrip의 내용 자세하게 보여줌

### 13.3.6 Optimizations

- 리소스 최적화 정도

확인하는 내용

- Keep-Alive 설정으로 서버와의 연결 유지
- [Gzip으로 리소스 압축](https://velog.io/@ss-won/FE-%EB%B2%88%EC%97%AD-Gzip-%EC%95%95%EC%B6%95%EC%9C%BC%EB%A1%9C-%EC%82%AC%EC%9D%B4%ED%8A%B8-%EC%B5%9C%EC%A0%81%ED%99%94%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95)
- [Progrssive JPEG](https://velog.io/@eunbinn/progressive-image-loading-react-tutorial)

### 13.3.7 Content

컨텐츠 에셋 정보 통계

### 13.3.8 Domains

에셋들 출처 도메인

### 13.3.9 Console Log

콘솔로그 기록 확인

### 13.3.10 Detected Technologies

웹 사이트를 개발하는 데 사용된 기술 확인 가능

### 13.3.11 Main-thread Processing

메인 스레드가 어떤 작업을 처리했는 지 확인 가능
